<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width, initial-scale=1">
<title>i</title>
<link rel=preconnect href=https://fonts.googleapis.com>
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel=stylesheet>
<link rel=icon type=image/x-icon href=favicon.svg>
<link rel="stylesheet" type="text/css" href="style/normalize.css">
<style type=text/css>:root{--primary-color:#0841ff;--secondary-color:#a5bde8;--bg-color:#f0f6ff}*{font-family:"Space Mono",monospace}canvas{display:flex}h3{min-width:1.2em;margin:0}nav{display:flex;position:fixed;width:100%;box-sizing:border-box;padding:20px;justify-content:space-between}.logo{width:40px;height:40px;cursor:pointer}.logo circle{transition:fill .5s}.logo:hover circle{fill:var(--primary-color)}#timer{position:fixed;top:0;left:0;width:100%;height:5px;background:#000;transition:background .1s;pointer-events:none}.count-container{display:grid;grid-template-columns:1fr auto;gap:10px;top:25px;right:20px;pointer-events:none}.ball{display:inline-block;width:1em;height:1em;background:var(--primary-color);border-radius:100%;margin:auto}#magnet-count{font-weight:400;color:var(--primary-color);margin:auto}#pop-up{position:fixed;display:flex;width:100vw;height:100vh;background:rgba(0,0,0,0.2);opacity:0;transition:opacity .5s;pointer-events:none}#pop-up .container{display:grid;width:100%;gap:20px;padding:0 20px calc(20px*2 + 1rem);margin-top:auto}#pop-up .container>*{margin:auto}#pop-up #message{display:flex;width:max-content;max-width:100%;font-size:1.5em;font-weight:700;background:#fff;border-radius:10px;box-sizing:border-box;color:var(--primary-color);padding:15px;pointer-events:none}#pop-up span{display:inline-block;text-align:center;margin:auto}#restart-instruction{color:#FFF;opacity:0;transition:opacity .5s}.watermark{position:fixed;bottom:20px;left:50%;width:max-content;max-width:calc(100vw - 40px);transform:translateX(-50%);text-align:center;color:var(--primary-color);pointer-events:none;z-index:100}</style>
</head>
<body>
<script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js integrity="sha512-rCZdHNB0AePry6kAnKAVFMRfWPmUXSo+/vlGtrOUvhsxD0Punm/xWbEh+8vppPIOzKB9xnk42yCRZ5MD/jvvjQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<div id=timer></div>
<nav>
<svg class=logo onclick=reset() width=181 height=181 viewBox="0 0 181 181" fill=none xmlns=http://www.w3.org/2000/svg><rect x=5.21688 y=52.8489 width=67.9218 height=174.37 rx=33.9609 transform="rotate(-45 5.21688 52.8489)" fill=#F0F6FF stroke=#0841FF stroke-width="6"/><rect x=128.515 y=4.82095 width=67.9218 height=174.37 rx=33.9609 transform="rotate(45 128.515 4.82095)" fill=#F0F6FF stroke=#0841FF stroke-width="6"/><circle cx=128.688 cy=52.6754 r=18.6115 transform="rotate(-45 128.688 52.6754)" fill=#F0F6FF stroke=#0841FF stroke-width="6"/></svg></div>
<div class=count-container><span class=ball></span><h3 id=magnet-count></h3></div>
</nav>
<div id=pop-up>
<div class=container>
<div id=restart-instruction>Click To Restart</div>
<div id=message>
<span></span>
</div>
</div>
</div>
<div class=watermark>Made with ‚ù§ in New Zealand</div>
<script type="text/javascript">var game;const DEBUG=!1,PRIMARY_COLOR="#0841ff",SECONDARY_COLOR="#a5bde8",BG_COLOR="#f0f6ff",ANIMATION_SPEED=8;function randomInt(t,i){return Math.floor(random(t,i+1))}function onHover(t,i,e,s){return!!(mouseX>=t&&mouseX<=t+e&&mouseY>=i&&mouseY<=i+s)}class Game{constructor(){this.state=-1;let t=9;windowWidth<450?t=5:windowWidth<600&&(t=6),this.grid=new Grid(this,t,9),this.grid.bars.forEach(t=>{t.attract(1)}),this.grid.deactivateMagnets(),this.initialTimerValue=this.grid.width*this.grid.height,this.timer=this.initialTimerValue,this.maxPreTimerValue=5,this.preTimer=0,this.coolDownTimer=6}getDt(){let t=1/frameRate();return isFinite(t)?t:0}updateTimer(){let t,i=document.querySelector("#timer"),e=this.getDt();-1==this.state?(this.preTimer+=e,t=this.preTimer/this.maxPreTimerValue*100+"%",this.preTimer>=this.maxPreTimerValue&&(t="100%",this.state=0,i.style.background=PRIMARY_COLOR)):0==this.state?(this.timer-=e,t=this.timer>0?this.timer/this.initialTimerValue*100+"%":0):1==this.state&&(this.coolDownTimer-=e,this.coolDownTimer<0&&(cursor("pointer"),document.querySelector("#restart-instruction").style.opacity=1)),i.style.width=t}mouseClickCallback(){if(0===this.state){let t=0;this.grid.magnets.forEach(i=>{i.isActive&&t++}),this.grid.selectedMagnet&&(this.grid.selectedMagnet.isActive?(this.grid.selectedMagnet.isActive=!1,t--):t<this.grid.maxMagCount&&(this.grid.selectedMagnet.isActive=!0,t++),this.grid.bars.forEach(t=>{t.attract(0)}),this.grid.checkWinState()),document.querySelector("#magnet-count").textContent=this.grid.maxMagCount-t}}resize(){this.grid.calcScale(),this.grid.calcOffset()}draw(){this.grid.draw()}}class Grid{constructor(t,i,e){for(this.game=t,this.width=i,this.height=e,this.nodeSize=80,this.nodes=[],this.bars=[],this.magnets=[],this.emptyNodeRadius=10,this.offsetX=0,this.offsetY=0,this.selectedMagnet=null,this.maxMagCount=0,this.scale=1,this.targetScale=this.scale,this.calcScale(),this.calcOffset(),this.populate();this.magnets.length<this.width*this.height*.5;){let s=randomInt(0,this.width-1),h=randomInt(0,this.height-1),a=this.nodes[h][s];"Bar"==a.constructor.name&&(this.bars.splice(this.bars.indexOf(a),1),this.setMagnet(s,h))}!this.maxMagCount&&(this.magnets[0].isActive=!0,this.maxMagCount++),document.querySelector("#magnet-count").textContent=this.maxMagCount}calcOffset(){this.scale;let t=(this.width-1)*this.nodeSize*this.scale,i=(this.height-1)*this.nodeSize*this.scale;this.offsetX=width/2-t/2,this.offsetY=height/2-i/2}calcScale(){let t=this.width*this.nodeSize*this.scale,i=this.height*this.nodeSize*this.scale,e=windowWidth/(t+100),s=windowHeight/(i+100);this.scale*=Math.min(e,s)}populate(){for(let t=0;t<this.height;t++){this.nodes.push([]);for(let i=0;i<this.width;i++){let e=new Bar(this,i,t);this.nodes[t][i]=e,this.bars.push(e)}}}checkAlignment(){let t=[],i=!0;return this.bars.some(e=>{if(e.targetRotation){if(e.targetRotation!=e.rotation)return i=!1,!0;t.push(e)}}),!!i&&t}checkWinState(){"object"==typeof this.checkAlignment()&&(this.game.state=1,setTimeout(()=>{document.querySelector("#pop-up").style.opacity=1,document.querySelector("#pop-up #message span").textContent=(this.game.timer>0?"Great Job!":"Too Slow!")+" "+(this.game.initialTimerValue-this.game.timer).toFixed(2)+"s"},3e3))}setMagnet(t,i){if(0<=t&&t<this.width&&0<=i&&i<this.height){let e=new Magnet(this,t,i);return this.nodes[i][t]=e,this.magnets.push(e),e}}deactivateMagnets(){this.magnets.forEach(t=>{t.isActive=!1})}locate(t,i){if(0<=t&&t<this.width&&0<=i&&i<this.height)return this.nodes[i][t]}allRotationComplete(){let t=!0;return this.bars.some(i=>{if(i.isRotating)return t=!1,!0}),t}draw(){this.selectedMagnet=null,translate(this.offsetX,this.offsetY),scale(this.scale);for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++){let e=this.nodes[t][i];1==this.game.state&&"Bar"==e.constructor.name&&e.targetRotation&&this.allRotationComplete()&&e.popAnimation(1.2),e.draw()}scale(1/this.scale)}}class Bar{constructor(t,i,e){this.game=t.game,this.grid=t,this.x=i,this.y=e,this.width=20,this.height=60,this.initialRotation=randomInt(0,7),this.rotation=this.initialRotation,this.targetRotation=null,this.angle=this.toAngle(this.rotation),this.isRotating=!1,this.isAttracted=!1,this.scale=1,this.popAnimationDirection=0}popAnimation(t){let i=0==this.popAnimationDirection?t:1,e=i-this.scale;.01>Math.abs(e)?(this.scale=i,this.popAnimationDirection=1):this.scale+=e*this.game.getDt()*8}toAngle(t){return radians(45*t)}getNeighbours(){let t=[];return[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]].forEach(i=>{let e=[this.x+i[0],this.y+i[1]],s=this.grid.locate(...e);s&&t.push(s)}),t}attract(t=1){let i=[];if(this.getNeighbours().forEach(t=>{if("Magnet"===t.constructor.name&&t.isActive){let e=[t.x-this.x,t.y-this.y],s;switch(JSON.stringify(e)){case"[0,-1]":s=0;break;case"[1,-1]":s=1;break;case"[1,0]":s=2;break;case"[1,1]":s=3;break;case"[0,1]":s=4;break;case"[-1,1]":s=5;break;case"[-1,0]":s=6;break;case"[-1,-1]":s=7}let h=t.getStrength();[1,3,5,7].indexOf(s)>-1&&(h-=.25),i.push({offset:e,direction:s,strength:h})}}),i.length){this.isAttracted=!0;let e=[],s=[{strength:0}];if(i.forEach(t=>{t.strength>s[0].strength?s=[t]:t.strength==s[0].strength&&s.push(t)}),s.forEach(t=>{e.push(t.direction)}),1==s.length)0==t?this.rotation=s[0].direction:this.targetRotation=s[0].direction;else{let h=s.reduce((t,i)=>t+i.direction,0)/s.length;if(h%1!=0){let a=[];e.forEach(t=>{let i=a.indexOf((t+4)%8);i>-1?a.splice(i,1):a.push(t)}),h=a[0]}-1===e.indexOf(h)&&-1===e.indexOf(h-1)&&-1===e.indexOf(h+1)&&(h=(h+4)%8),0==t?this.rotation=h:this.targetRotation=h}if(1==t){let r=Math.abs(this.targetRotation-this.initialRotation);this.targetRotation&&(0==r||4==r)&&(this.initialRotation=(this.initialRotation+1)%8,this.rotation=this.initialRotation,this.angle=this.toAngle(this.rotation))}}else this.isAttracted=!1,this.rotation=this.initialRotation}drawBar(t,i,e){let s=this.x*this.grid.nodeSize,h=this.y*this.grid.nodeSize,a=this.width/2,r=this.height/2;translate(s,h),rotate(t),scale(this.scale),fill(e),rect(0,0,this.width,this.height,20),fill(i),circle(0,0-r+a,a),scale(1/this.scale),rotate(-t),translate(-s,-h)}draw(){this.targetRotation&&(strokeWeight(2),stroke(PRIMARY_COLOR),this.drawBar(this.toAngle(this.targetRotation),BG_COLOR,BG_COLOR),strokeWeight(0));let t=this.toAngle(this.rotation),i=t-this.angle;.01>Math.abs(i)?(this.angle=t,this.isRotating=!1):(this.angle+=i*this.game.getDt()*8,this.isRotating=!0),this.drawBar(this.angle,BG_COLOR,0)}}class Magnet{constructor(t,i,e){this.game=t.game,this.grid=t,this.x=i,this.y=e,this.strength=1,this.isActive=Boolean(randomInt(0,1)),this.activeRadius=30,this.inActiveRadius=0,this.radius=this.inActiveRadius,this.isActive&&this.grid.maxMagCount++}getNeighbours(){let t=[];return[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]].forEach(i=>{let e=[this.x+i[0],this.y+i[1]],s=this.grid.locate(...e);s&&t.push(s)}),t}getStrength(){let t=this.strength;return this.getNeighbours().forEach(i=>{"Magnet"===i.constructor.name&&i.isActive&&Math.abs(i.x-this.x)+Math.abs(i.y-this.y)==1&&(t+=i.strength)}),t}draw(){let t=this.x*this.grid.nodeSize,i=this.y*this.grid.nodeSize,e=this.grid.nodeSize/2,s=this.isActive?this.activeRadius:this.inActiveRadius;0==this.game.state&&onHover(t*this.grid.scale+this.grid.offsetX-e,i*this.grid.scale+this.grid.offsetY-e,this.grid.nodeSize*this.grid.scale,this.grid.nodeSize*this.grid.scale)&&(this.grid.selectedMagnet=this,s+=.3*s||20,cursor("pointer"));let h=s-this.radius;this.radius=.01>Math.abs(h)?s:this.radius+h*this.game.getDt()*8,this.radius>0&&fill(PRIMARY_COLOR),circle(t,i,this.radius)}}function reset(){document.querySelector("#pop-up").style.opacity=0,document.querySelector("#restart-instruction").style.opacity=0,document.querySelector("#timer").style.background="#000",setTimeout(function(){game=new Game},500)}function setup(){createCanvas(windowWidth,windowHeight),rectMode(CENTER),game=new Game}function draw(){noStroke(),background(BG_COLOR),cursor("auto"),game.draw(),game.updateTimer()}function mouseClicked(){game.mouseClickCallback(),game.coolDownTimer<0&&reset()}function windowResized(){resizeCanvas(windowWidth,windowHeight),game.resize()}</script>
</body>
</html>